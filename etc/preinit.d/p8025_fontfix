fontFix_bind(){
  if [ -f "$2" ]; then
    mount_bind "$1" "$2" || return 1
  fi
  return 0
}
fontFix(){
  if [ "$cfg_fontfix_enabled" == "y" ]; then
    local titleFontPath="$rootfs/usr/share/fonts/title.fnt"
    local copyrightFontPath="$rootfs/usr/share/fonts/copyright.fnt"
    local debugFontPath=""
    local sFontPath=""
    local mFontPath=""
    local lFontPath=""
    
    # Title Font
    [ -f "$squashfs$gamepath/title.fnt" ] && titleFontPath="$squashfs$gamepath/title.fnt"
    [ -f "$installpath/fonts/title.fnt" ] && titleFontPath="$installpath/fonts/title.fnt"
    [ -f "$mountpoint/media/$modname/fonts/title.fnt" ] && titleFontPath="$mountpoint/media/$modname/fonts/title.fnt"
    
    # Copyright Font
    [ -f "$squashfs$gamepath/copyright.fnt" ] && copyrightFontPath="$squashfs$gamepath/copyright.fnt"
    [ -f "$installpath/fonts/copyright.fnt" ] && copyrightFontPath="$installpath/fonts/copyright.fnt"
    [ -f "$mountpoint/media/$modname/fonts/copyright.fnt" ] && copyrightFontPath="$mountpoint/media/$modname/fonts/copyright.fnt"
    
    # Debug Font
    [ -f "$installpath/fonts/debug.fnt" ] && debugFontPath="$installpath/fonts/debug.fnt"
    [ -f "$mountpoint/media/$modname/fonts/debug.fnt" ] && debugFontPath="$mountpoint/media/$modname/fonts/debug.fnt"
    
    # Small Font
    [ -f "$installpath/fonts/small.fnt" ] && sFontPath="$installpath/fonts/small.fnt"
    [ -f "$mountpoint/media/$modname/fonts/small.fnt" ] && sFontPath="$mountpoint/media/$modname/fonts/small.fnt"
    
    # Medium Font
    [ -f "$installpath/fonts/medium.fnt" ] && mFontPath="$installpath/fonts/medium.fnt"
    [ -f "$mountpoint/media/$modname/fonts/medium.fnt" ] && mFontPath="$mountpoint/media/$modname/fonts/medium.fnt"
    
    # Large Font
    [ -f "$installpath/fonts/large.fnt" ] && lFontPath="$installpath/fonts/large.fnt"
    [ -f "$mountpoint/media/$modname/fonts/large.fnt" ] && lFontPath="$mountpoint/media/$modname/fonts/large.fnt"
    
    case "$sftype" in
      nes)
        
        # Title Font
        [ -d "$rootfs$gamepath" ] && rsync -ac "$titleFontPath" "$rootfs$gamepath/"
        
        # Copyright Font
        [ -d "$rootfs$gamepath" ] && rsync -ac "$copyrightFontPath" "$rootfs$gamepath/"
        
        # Debug Font
        [ -f "$debugFontPath" ] && fontFix_bind "$debugFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/debug.fnt"
        
        # Small Font
        if [ -f "$sFontPath" ]; then
          fontFix_bind "$sFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/nes/s.fnt"
          fontFix_bind "$sFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/hvc/s.fnt"
        fi
        
        # Medium Font
        if [ -f "$mFontPath" ]; then
          fontFix_bind "$mFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/nes/m.fnt"
          fontFix_bind "$mFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/hvc/m.fnt"
        fi
        
        # Large Font
        if [ -f "$lFontPath" ]; then
          fontFix_bind "$lFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/nes/l.fnt"
          fontFix_bind "$lFontPath" "$mountpoint/usr/share/clover-ui/resources/fonts/hvc/l.fnt"
        fi
        ;;
      snes)
        # Title Font
        if [ -f "$titleFontPath" ]; then
          fontFix_bind "$titleFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/title.font"
          fontFix_bind "$titleFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/title.font"
          fontFix_bind "$titleFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/title.font"
        fi
        
        # Copyright Font
        if [ -f "$copyrightFontPath" ]; then
          fontFix_bind "$copyrightFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/copyright.fnt"
          fontFix_bind "$copyrightFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/copyright.fnt"
          fontFix_bind "$copyrightFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/copyright.fnt"
        fi
        
        # Debug Font
        if [ -f "$debugFontPath" ]; then
          fontFix_bind "$debugFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/debug.font"
          fontFix_bind "$debugFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/debug.font"
          fontFix_bind "$debugFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/debug.font"
        fi
        
        # Small Font
        if [ -f "$sFontPath" ]; then
          fontFix_bind "$sFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/s.font"
          fontFix_bind "$sFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/s.font"
          fontFix_bind "$sFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/s.fnt"
        fi
        
        # Medium Font
        if [ -f "$mFontPath" ]; then
          fontFix_bind "$mFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/m.font"
          fontFix_bind "$mFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/m.font"
          fontFix_bind "$mFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/m.fnt"
        fi
        
        # Large Font
        if [ -f "$lFontPath" ]; then
          fontFix_bind "$lFontPath" "$mountpoint/usr/share/ui/snes-usa/resources/fonts/l.font"
          fontFix_bind "$lFontPath" "$mountpoint/usr/share/ui/snes-eur/resources/fonts/l.font"
          fontFix_bind "$lFontPath" "$mountpoint/usr/share/ui/shvc/resources/fonts/l.fnt"
        fi
        ;;
    esac
  else
    if [ "$sftype" == "nes" ] && [ -d "$rootfs$gamepath" ]; then
      find "$rootfs$gamepath" -name "*.fnt" -exec rm {} \;
      restore "$gamepath/title.fnt"
      restore "$gamepath/copyright.fnt"
    fi
  fi
}
fontFix
